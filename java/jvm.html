<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM性能调优 TODO | Yolo Cloud</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="Yolo Cloud 记录了我技术成长中学到的各种知识,遇到的各种问题">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.2f3fe2a3.js" as="script"><link rel="preload" href="/assets/js/2.d5f9c639.js" as="script"><link rel="preload" href="/assets/js/17.f717296a.js" as="script"><link rel="prefetch" href="/assets/js/10.2f523759.js"><link rel="prefetch" href="/assets/js/11.8f996e6a.js"><link rel="prefetch" href="/assets/js/12.df0985c9.js"><link rel="prefetch" href="/assets/js/13.f5547960.js"><link rel="prefetch" href="/assets/js/14.f8d0d54c.js"><link rel="prefetch" href="/assets/js/15.4475e7ac.js"><link rel="prefetch" href="/assets/js/16.fa6b8bdf.js"><link rel="prefetch" href="/assets/js/18.0c116502.js"><link rel="prefetch" href="/assets/js/19.68ca3b64.js"><link rel="prefetch" href="/assets/js/20.51d4d605.js"><link rel="prefetch" href="/assets/js/21.2c247800.js"><link rel="prefetch" href="/assets/js/22.e90c3a25.js"><link rel="prefetch" href="/assets/js/23.02ae9aa3.js"><link rel="prefetch" href="/assets/js/24.2cdf27fe.js"><link rel="prefetch" href="/assets/js/25.381ec9c4.js"><link rel="prefetch" href="/assets/js/26.809e1ba3.js"><link rel="prefetch" href="/assets/js/27.27552cc9.js"><link rel="prefetch" href="/assets/js/3.ebfb06a0.js"><link rel="prefetch" href="/assets/js/4.e15934b3.js"><link rel="prefetch" href="/assets/js/5.4639c99e.js"><link rel="prefetch" href="/assets/js/6.419819d1.js"><link rel="prefetch" href="/assets/js/7.670902b9.js"><link rel="prefetch" href="/assets/js/8.d87586ac.js"><link rel="prefetch" href="/assets/js/9.ea5fd5c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yolo Cloud</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://github.com/linG5821" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://github.com/linG5821" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/machine/" class="sidebar-heading clickable"><span>机器环境</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/network/" class="sidebar-link">网络编程</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/database/" class="sidebar-heading clickable"><span>数据库</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/middleware/" class="sidebar-link">中间件</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/container/" class="sidebar-heading clickable"><span>容器技术</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/java/" class="sidebar-heading clickable router-link-active open"><span>Java</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/jvm.html" aria-current="page" class="active sidebar-link">Java虚拟机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/jvm.html#jvm性能调优-todo" class="sidebar-link">JVM性能调优 TODO</a></li><li class="sidebar-sub-header"><a href="/java/jvm.html#自行编译jdk" class="sidebar-link">自行编译JDK</a></li></ul></li><li><a href="/java/reactive.html" class="sidebar-link">Java响应式编程</a></li><li><a href="/java/maven.html" class="sidebar-link">Maven</a></li><li><a href="/java/spring-cloud.html" class="sidebar-link">SpringCloud</a></li></ul></section></li><li><a href="/go/" class="sidebar-link">Go</a></li><li><a href="/php/" class="sidebar-link">PHP</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="jvm性能调优-todo"><a href="#jvm性能调优-todo" class="header-anchor">#</a> JVM性能调优 TODO</h2> <div class="language- extra-class"><pre class="language-text"><code># java8 以前 应当设置 -XX:PermSize -XX:MaxPermSize
# java8 以后 应当设置 -XX:MaxMetaspaceSize -XX:MetaspaceSize

# 1. Java堆大小设置，Xms和Xmx设置为老年代存活对象的3-4倍，即FullGC之后的老年代内存占用的3-4倍
# 2. 永久代(元空间) PermSize和MaxPermSize / MetaspaceSize和MaxMetaspaceSize 设置为老年代存活对象的1.2-1.5倍。
# 3. 年轻代Xmn的设置为老年代存活对象的1-1.5倍。
# 4. 老年代的内存大小设置为老年代存活对象的2-3倍。

# 假如 jstat -gc 1234

OU 为 905371.7 900M

jvm配置为
-XX:MetaspaceSize=1536M -XX:MaxMetaspaceSize=1536M
-Xms4096m -Xmx4096m

-XX:MetaspaceSize=180M -XX:MaxMetaspaceSize=180M -Xms512m -Xmx512m

</code></pre></div><h2 id="自行编译jdk"><a href="#自行编译jdk" class="header-anchor">#</a> 自行编译JDK</h2> <ol><li>编译参数设置</li></ol> <div class="language-ini extra-class"><pre class="language-ini"><code>export LANG<span class="token attr-value"><span class="token punctuation">=</span>C</span>
export ALT_BOOTDIR<span class="token attr-value"><span class="token punctuation">=</span>/usr/share/java</span>
export ALLOW_DOWNLOADS<span class="token attr-value"><span class="token punctuation">=</span>true</span>
export HOTSPOT_BUILD_JOBS<span class="token attr-value"><span class="token punctuation">=</span>8</span>
export ALT_PARALLEL_COMPILE_JOBS<span class="token attr-value"><span class="token punctuation">=</span>8</span>
export SKIP_COMPARE_IMAGES<span class="token attr-value"><span class="token punctuation">=</span>true</span>
<span class="token comment"># 使用预编译头文件 编译加快</span>
export USE_PRECOMPILED_HEADER<span class="token attr-value"><span class="token punctuation">=</span>true</span>
<span class="token comment"># 要编译的内容</span>
export BUILD_LANGTOOLS<span class="token attr-value"><span class="token punctuation">=</span>true</span>
<span class="token comment">#export BUILD_JAXP=false</span>
<span class="token comment">#export BUILD_JAXWS=false</span>
<span class="token comment">#export BUILD_CORBA=false</span>
export BUILD_HOTSPOT<span class="token attr-value"><span class="token punctuation">=</span>true</span>
export BUILD_JDK<span class="token attr-value"><span class="token punctuation">=</span>true</span>
<span class="token comment">#要编译的版本</span>
<span class="token comment">#export SKIP_DEBUG_BUILD=false</span>
<span class="token comment">#export SKIP_FASTDEBUG_BUILD=true</span>
<span class="token comment">#export DEBUG_NAME=debug</span>
<span class="token comment">#设置为false可以避开javaws和浏览器Java插件的build</span>
export BUILD_DEPLOY<span class="token attr-value"><span class="token punctuation">=</span>false</span>
<span class="token comment">#设置为false不会build出安装包 安装包中有一些奇怪的依赖</span>
export BUILD_INSTALL<span class="token attr-value"><span class="token punctuation">=</span>false</span>
export ALT_OUTPUTDIR<span class="token attr-value"><span class="token punctuation">=</span>/home/ling/jdk/build</span>
export DEBUG_BINARIES<span class="token attr-value"><span class="token punctuation">=</span>true</span>
<span class="token comment">#设置HotSpot编译为64位版本</span>
export LP64<span class="token attr-value"><span class="token punctuation">=</span>1</span>

./configure --enable-debug 创建编译配置 不指定参数构建为release版本
</code></pre></div><ol start="2"><li>编译成功的提示</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>----- Build <span class="token builtin class-name">times</span> -------
Start <span class="token number">2020</span>-03-14 03:31:24
End   <span class="token number">2020</span>-03-14 03:44:35
00:00:48 corba
00:05:41 hotspot
00:00:43 jaxp
00:01:11 jaxws
00:04:46 jdk
00:00:01 langtools
00:13:11 TOTAL
-------------------------
Finished building OpenJDK <span class="token keyword">for</span> target <span class="token string">'default'</span>

WARNING: You have the following ALT_ variables set:
<span class="token assign-left variable">ALT_PARALLEL_COMPILE_JOBS</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">ALT_BOOTDIR</span><span class="token operator">=</span>/usr/share/java <span class="token assign-left variable">ALT_OUTPUTDIR</span><span class="token operator">=</span>/home/ling/jdk/build
ALT_ variables are deprecated and will be ignored. Please clean your environment.


ling@aidong:~/jdk$ /home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/jdk/bin/javac ./HelloWorld.java
ling@aidong:~/jdk$ <span class="token function">ls</span>
ASSEMBLY_EXCEPTION  HelloWorld.java  Makefile  README-builds.html  build   configure  get_source.sh  jaxp   jdk        <span class="token function">make</span>     <span class="token builtin class-name">test</span>
HelloWorld.class    LICENSE          README    THIRD_PARTY_README  common  corba      hotspot        jaxws  langtools  nashorn
ling@aidong:~/jdk$ java HelloWorld
HelloWorld openjdk
</code></pre></div><ol start="3"><li>运行虚拟机</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 添加环境变量</span>
<span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>.:<span class="token variable">${JAVA_HOME}</span>/jre/lib/amd64/native_threads:<span class="token variable">${JAVA_HOME}</span>/jre/lib/amd64
</code></pre></div><ol start="4"><li><p>编译错误汇总</p> <ul><li>ubuntu内核版本过高</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code> *** This OS is not supported: Linux aidong <span class="token number">4.4</span>.0-18362-Microsoft <span class="token comment">#476-Microsoft Fri Nov 01 16:53:00 PST 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
 /home/ling/jdk/hotspot/make/linux/Makefile:234: recipe <span class="token keyword">for</span> target <span class="token string">'check_os_version'</span> failed
 make<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>check_os_version<span class="token punctuation">]</span> Error <span class="token number">1</span>
 make<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>linux_amd64_compiler2/debug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 /home/ling/jdk/hotspot/make/linux/Makefile:255: recipe <span class="token keyword">for</span> target <span class="token string">'linux_amd64_compiler2/debug'</span> failed
 Makefile:216: recipe <span class="token keyword">for</span> target <span class="token string">'generic_build2'</span> failed
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>generic_build2<span class="token punctuation">]</span> Error <span class="token number">2</span>
 Makefile:167: recipe <span class="token keyword">for</span> target <span class="token string">'fastdebug'</span> failed
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>fastdebug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>/home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/hotspot/_hotspot.timestamp<span class="token punctuation">]</span> Error <span class="token number">2</span>
 HotspotWrapper.gmk:44: recipe <span class="token keyword">for</span> target <span class="token string">'/home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/hotspot/_hotspot.timestamp'</span> failed
 /home/ling/jdk//make/Main.gmk:108: recipe <span class="token keyword">for</span> target <span class="token string">'hotspot-only'</span> failed
 make: *** <span class="token punctuation">[</span>hotspot-only<span class="token punctuation">]</span> Error <span class="token number">2</span>

 <span class="token comment"># 解决方案:vim make/linux/Makefile</span>
 :/SUPPORTED_OS_VERSION 搜索改关键字
 - SUPPORTED_OS_VERSION <span class="token operator">=</span> <span class="token number">2.4</span>% <span class="token number">2.5</span>% <span class="token number">2.6</span>% <span class="token number">3</span>%
 + SUPPORTED_OS_VERSION <span class="token operator">=</span> <span class="token number">2.4</span>% <span class="token number">2.5</span>% <span class="token number">2.6</span>% <span class="token number">4</span>%

 <span class="token comment"># 解决方案:vim xxx/hotspot/make/linux/Makefile 67行</span>
</code></pre></div><ul><li>make版本的问题，4.0以后make-I和-j选项混乱</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code> /usr/bin/make: invalid option -- <span class="token string">'/'</span>
 /usr/bin/make: invalid option -- <span class="token string">'a'</span>
 /usr/bin/make: invalid option -- <span class="token string">'/'</span>
 /usr/bin/make: invalid option -- <span class="token string">'c'</span>
 Usage: <span class="token function">make</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>target<span class="token punctuation">]</span> <span class="token punctuation">..</span>.
 Options:
 -b, -m                      Ignored <span class="token keyword">for</span> compatibility.
 -B, --always-make           Unconditionally <span class="token function">make</span> all targets.
 -C DIRECTORY, --directory<span class="token operator">=</span>DIRECTORY
                             Change to DIRECTORY before doing anything.
 -d                          Print lots of debugging information.
 --debug<span class="token punctuation">[</span><span class="token operator">=</span>FLAGS<span class="token punctuation">]</span>             Print various types of debugging information.
 -e, --environment-overrides
                             Environment variables override makefiles.
 --eval<span class="token operator">=</span>STRING               Evaluate STRING as a makefile statement.
 -f FILE, --file<span class="token operator">=</span>FILE, --makefile<span class="token operator">=</span>FILE
                             Read FILE as a makefile.
 -h, --help                  Print this message and exit.
 -i, --ignore-errors         Ignore errors from recipes.
 -I DIRECTORY, --include-dir<span class="token operator">=</span>DIRECTORY
                             Search DIRECTORY <span class="token keyword">for</span> included makefiles.
 -j <span class="token punctuation">[</span>N<span class="token punctuation">]</span>, --jobs<span class="token punctuation">[</span><span class="token operator">=</span>N<span class="token punctuation">]</span>          Allow N <span class="token function">jobs</span> at once<span class="token punctuation">;</span> infinite <span class="token function">jobs</span> with no arg.
 -k, --keep-going            Keep going when some targets can<span class="token string">'t be made.
 -l [N], --load-average[=N], --max-load[=N]
                             Don'</span>t start multiple <span class="token function">jobs</span> unless load is below N.
 -L, --check-symlink-times   Use the latest mtime between symlinks and target.
 -n, --just-print, --dry-run, --recon
                             Don<span class="token string">'t actually run any recipe; just print them.
 -o FILE, --old-file=FILE, --assume-old=FILE
                             Consider FILE to be very old and don'</span>t remake it.
 -O<span class="token punctuation">[</span>TYPE<span class="token punctuation">]</span>, --output-sync<span class="token punctuation">[</span><span class="token operator">=</span>TYPE<span class="token punctuation">]</span>
                             Synchronize output of parallel <span class="token function">jobs</span> by TYPE.
 -p, --print-data-base       Print <span class="token function">make</span><span class="token string">'s internal database.
 -q, --question              Run no recipe; exit status says if up to date.
 -r, --no-builtin-rules      Disable the built-in implicit rules.
 -R, --no-builtin-variables  Disable the built-in variable settings.
 -s, --silent, --quiet       Don'</span>t <span class="token builtin class-name">echo</span> recipes.
 -S, --no-keep-going, --stop
                             Turns off -k.
 -t, --touch                 Touch targets instead of remaking them.
 --trace                     Print tracing information.
 -v, --version               Print the version number of <span class="token function">make</span> and exit.
 -w, --print-directory       Print the current directory.
 --no-print-directory        Turn off -w, even <span class="token keyword">if</span> it was turned on implicitly.
 -W FILE, --what-if<span class="token operator">=</span>FILE, --new-file<span class="token operator">=</span>FILE, --assume-new<span class="token operator">=</span>FILE
                             Consider FILE to be infinitely new.
 --warn-undefined-variables  Warn when an undefined variable is referenced.

 This program built <span class="token keyword">for</span> x86_64-pc-linux-gnu
 Report bugs to <span class="token operator">&lt;</span>bug-make@gnu.org<span class="token operator">&gt;</span>
 make<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>ad_stuff<span class="token punctuation">]</span> Error <span class="token number">2</span>
 /home/ling/jdk/hotspot/make/linux/makefiles/top.make:91: recipe <span class="token keyword">for</span> target <span class="token string">'ad_stuff'</span> failed
 /home/ling/jdk/hotspot/make/linux/Makefile:289: recipe <span class="token keyword">for</span> target <span class="token string">'fastdebug'</span> failed
 make<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>fastdebug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 Makefile:216: recipe <span class="token keyword">for</span> target <span class="token string">'generic_build2'</span> failed
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>generic_build2<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>fastdebug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 Makefile:167: recipe <span class="token keyword">for</span> target <span class="token string">'fastdebug'</span> failed
 HotspotWrapper.gmk:44: recipe <span class="token keyword">for</span> target <span class="token string">'/home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/hotspot/_hotspot.timestamp'</span> failed
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>/home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/hotspot/_hotspot.timestamp<span class="token punctuation">]</span> Error <span class="token number">2</span>
 /home/ling/jdk//make/Main.gmk:108: recipe <span class="token keyword">for</span> target <span class="token string">'hotspot-only'</span> failed
 make: *** <span class="token punctuation">[</span>hotspot-only<span class="token punctuation">]</span> Error <span class="token number">2</span>

 <span class="token comment"># 解决方案一: 降级make4.0以下(未测试)</span>
 
 <span class="token comment"># 解决方案二:</span>
 <span class="token function">vim</span> xxx/hotspot/make/linux/makefiles/adjust-mflags.sh
 - s/ -<span class="token punctuation">\</span><span class="token punctuation">(</span><span class="token punctuation">[</span>^     <span class="token punctuation">]</span><span class="token punctuation">[</span>^     <span class="token punctuation">]</span>*<span class="token punctuation">\</span><span class="token punctuation">)</span>j/ -<span class="token punctuation">\</span><span class="token number">1</span> -j/
 + s/ -<span class="token punctuation">\</span><span class="token punctuation">(</span><span class="token punctuation">[</span>^     I<span class="token punctuation">]</span><span class="token punctuation">[</span>^     <span class="token punctuation">]</span>*<span class="token punctuation">\</span><span class="token punctuation">)</span>j/ -<span class="token punctuation">\</span><span class="token number">1</span> -j/
</code></pre></div><ul><li>gcc/g++ 版本过高</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code> In <span class="token function">file</span> included from /home/ling/jdk/hotspot/src/share/vm/memory/sharedHeap.hpp:29:0,
         from /home/ling/jdk/hotspot/src/share/vm/gc_implementation/parallelScavenge/psParallelCompact.hpp:34,
         from /home/ling/jdk/hotspot/src/share/vm/gc_implementation/shared/markSweep.inline.hpp:33,
         from /home/ling/jdk/hotspot/src/share/vm/oops/oop.inline.hpp:29,
         from /home/ling/jdk/hotspot/src/share/vm/classfile/classFileParser.hpp:30,
         from /home/ling/jdk/hotspot/src/share/vm/classfile/classLoader.hpp:28,
         from /home/ling/jdk/hotspot/src/share/vm/classfile/systemDictionary.hpp:29,
         from /home/ling/jdk/hotspot/src/share/vm/ci/ciEnv.hpp:30,
         from /home/ling/jdk/hotspot/src/share/vm/ci/ciUtilities.hpp:28,
         from /home/ling/jdk/hotspot/src/share/vm/ci/ciNullObject.hpp:30,
         from /home/ling/jdk/hotspot/src/share/vm/ci/ciConstant.hpp:29,
         from /home/ling/jdk/hotspot/src/share/vm/ci/ciArray.hpp:29,
         from /home/ling/jdk/hotspot/src/share/vm/precompiled/precompiled.hpp:33:
 /home/ling/jdk/hotspot/src/share/vm/memory/generation.hpp:421:17: error: invalid suffix on literal<span class="token punctuation">;</span> C++11 requires a space between literal and string macro <span class="token punctuation">[</span>-Werror<span class="token operator">=</span>literal-suffix<span class="token punctuation">]</span>
         warning<span class="token punctuation">(</span><span class="token string">&quot;time warp: &quot;</span>INT64_FORMAT<span class="token string">&quot; to &quot;</span>INT64_FORMAT, _time_of_last_gc, now<span class="token punctuation">)</span><span class="token punctuation">;</span>
              ^
 <span class="token comment"># 解决方案</span>
 <span class="token comment"># 这里出现问题的原因是ubuntu版本过高,18.04默认的gcc/g++版本为7.0</span>
 <span class="token comment"># 执行降级操作</span>
 <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gcc-4.8
 <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> g++-4.8
 <span class="token function">sudo</span> update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 <span class="token number">100</span>
 <span class="token function">sudo</span> update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 <span class="token number">100</span>
 降级操作后需要重新执行./configure --enable-debug 否则版本即使gcc/g++ --version变了还是会报错
 <span class="token function">make</span>  <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token variable">$ALT_OUTPUTDIR</span>/build.log
</code></pre></div><ul><li>make错误</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code> In <span class="token function">file</span> included from /home/ling/jdk/hotspot/src/share/vm/utilities/histogram.hpp:32:0,
         from /home/ling/jdk/hotspot/src/share/vm/runtime/mutex.hpp:30,
         from /home/ling/jdk/hotspot/src/share/vm/classfile/classLoaderData.hpp:32,
         from /home/ling/jdk/hotspot/src/share/vm/oops/typeArrayKlass.hpp:28,
         from /home/ling/jdk/hotspot/src/share/vm/oops/typeArrayOop.hpp:29,
         from /home/ling/jdk/hotspot/src/share/vm/oops/constantPool.hpp:32,
         from /home/ling/jdk/hotspot/src/share/vm/oops/method.hpp:33,
         from /home/ling/jdk/hotspot/src/share/vm/runtime/frame.hpp:28,
         from /home/ling/jdk/hotspot/src/share/vm/code/codeBlob.hpp:30,
         from /home/ling/jdk/hotspot/src/share/vm/code/codeCache.hpp:28,
         from /home/ling/jdk/hotspot/src/cpu/x86/vm/assembler_x86.inline.hpp:30,
         from /home/ling/jdk/hotspot/src/share/vm/asm/assembler.inline.hpp:31,
         from /home/ling/jdk/hotspot/src/share/vm/precompiled/precompiled.hpp:30:
 /home/ling/jdk/hotspot/src/os/linux/vm/os_linux.inline.hpp: In static member <span class="token keyword">function</span> <span class="token string">'static dirent* os::readdir(DIR*, dirent*)'</span><span class="token builtin class-name">:</span>
 /home/ling/jdk/hotspot/src/os/linux/vm/os_linux.inline.hpp:142:18: error: <span class="token string">'int readdir_r(DIR*, dirent*, dirent**)'</span> is deprecated <span class="token punctuation">(</span>declared at /usr/include/dirent.h:183<span class="token punctuation">)</span> <span class="token punctuation">[</span>-Werror<span class="token operator">=</span>deprecated-declarations<span class="token punctuation">]</span>
 <span class="token keyword">if</span><span class="token variable"><span class="token punctuation">((</span>status <span class="token operator">=</span> <span class="token operator">:</span><span class="token operator">:</span>readdir_r<span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> dbuf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">))</span></span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 ^
 /home/ling/jdk/hotspot/src/os/linux/vm/os_linux.inline.hpp:142:42: error: <span class="token string">'int readdir_r(DIR*, dirent*, dirent**)'</span> is deprecated <span class="token punctuation">(</span>declared at /usr/include/dirent.h:183<span class="token punctuation">)</span> <span class="token punctuation">[</span>-Werror<span class="token operator">=</span>deprecated-declarations<span class="token punctuation">]</span>
 <span class="token keyword">if</span><span class="token variable"><span class="token punctuation">((</span>status <span class="token operator">=</span> <span class="token operator">:</span><span class="token operator">:</span>readdir_r<span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> dbuf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">))</span></span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                         ^
 cc1plus: all warnings being treated as errors
 /home/ling/jdk/hotspot/make/linux/makefiles/vm.make:295: recipe <span class="token keyword">for</span> target <span class="token string">'precompiled.hpp.gch'</span> failed
 make<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>precompiled.hpp.gch<span class="token punctuation">]</span> Error <span class="token number">1</span>
 /home/ling/jdk/hotspot/make/linux/makefiles/top.make:119: recipe <span class="token keyword">for</span> target <span class="token string">'the_vm'</span> failed
 make<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>the_vm<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>fastdebug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 /home/ling/jdk/hotspot/make/linux/Makefile:289: recipe <span class="token keyword">for</span> target <span class="token string">'fastdebug'</span> failed
 Makefile:216: recipe <span class="token keyword">for</span> target <span class="token string">'generic_build2'</span> failed
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>generic_build2<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>fastdebug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 Makefile:167: recipe <span class="token keyword">for</span> target <span class="token string">'fastdebug'</span> failed
 HotspotWrapper.gmk:44: recipe <span class="token keyword">for</span> target <span class="token string">'/home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/hotspot/_hotspot.timestamp'</span> failed
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>/home/ling/jdk/build/linux-x86_64-normal-server-fastdebug/hotspot/_hotspot.timestamp<span class="token punctuation">]</span> Error <span class="token number">2</span>
 /home/ling/jdk//make/Main.gmk:108: recipe <span class="token keyword">for</span> target <span class="token string">'hotspot-only'</span> failed
 make: *** <span class="token punctuation">[</span>hotspot-only<span class="token punctuation">]</span> Error <span class="token number">2</span>
 
 <span class="token comment"># 解决方案:</span>
 <span class="token function">vim</span> xxx/hotspot/make/linux/makefiles/gcc.make
 注释 WARNINGS_ARE_ERRORS <span class="token operator">=</span> -Werror
 或者 WARNINGS_ARE_ERRORS <span class="token operator">=</span> -Wno-all  
 相关Warning都可以通过这个关闭
</code></pre></div><ul><li>单独编译JAVA虚拟机错误check_j2se_version版本不通过</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code> /usr/share/java/bin/javap javax.xml.transform.TransformerFactory <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
 <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token punctuation">\</span>
 /usr/share/java/bin/java -version<span class="token punctuation">;</span> <span class="token punctuation">\</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;*** An XSLT processor (J2SE 1.4.x or newer) is required&quot;</span> <span class="token punctuation">\</span>
 <span class="token string">&quot;to bootstrap this build&quot;</span> <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token file-descriptor important">&amp;2</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
 <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
 <span class="token keyword">fi</span>
 /bin/sh: <span class="token number">3</span>: /usr/share/java/bin/java: not found
 *** An XSLT processor <span class="token punctuation">(</span>J2SE <span class="token number">1.4</span>.x or newer<span class="token punctuation">)</span> is required to bootstrap this build
 /home/ling/jdk/hotspot/make/linux/Makefile:241: recipe <span class="token keyword">for</span> target <span class="token string">'check_j2se_version'</span> failed
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>check_j2se_version<span class="token punctuation">]</span> Error <span class="token number">1</span>
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/build'</span>
 /home/ling/jdk/hotspot/make/linux/Makefile:255: recipe <span class="token keyword">for</span> target <span class="token string">'linux_i486_compiler2/debug'</span> failed
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>linux_i486_compiler2/debug<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/build'</span>
 Makefile:216: recipe <span class="token keyword">for</span> target <span class="token string">'generic_build2'</span> failed
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>generic_build2<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/hotspot/make'</span>
 Makefile:167: recipe <span class="token keyword">for</span> target <span class="token string">'product'</span> failed
 make: *** <span class="token punctuation">[</span>product<span class="token punctuation">]</span> Error <span class="token number">2</span>
 
 <span class="token comment"># 解决方案:</span>
 ALT_BOOTDIR需要配置正确的jdk路径
 apt-get安装的java路径默认为 /usr/lib/jvm/java-8-openjdk-amd64/bin
</code></pre></div><ul><li>单独构建虚拟机报错:默认构建32版本的HotSpot 未安装32位lib是报错</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>In <span class="token function">file</span> included from /home/ling/jdk/hotspot/src/share/vm/prims/jni.h:39:0,
              from /home/ling/jdk/hotspot/src/share/vm/prims/jvm.h:28,
              from /home/ling/jdk/hotspot/src/share/vm/utilities/debug.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/runtime/globals.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/memory/allocation.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/memory/iterator.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/memory/genOopClosures.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/oops/klass.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/runtime/handles.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/memory/universe.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/code/oopRecorder.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/asm/codeBuffer.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/asm/assembler.hpp:28,
              from /home/ling/jdk/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
 /usr/include/stdio.h:27:36: fatal error: bits/libc-header-start.h: No such <span class="token function">file</span> or directory
 <span class="token comment">#include &lt;bits/libc-header-start.h&gt;</span>
                                     ^
 compilation terminated.
 /home/ling/jdk/hotspot/make/linux/makefiles/vm.make:295: recipe <span class="token keyword">for</span> target <span class="token string">'precompiled.hpp.gch'</span> failed
 make<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>precompiled.hpp.gch<span class="token punctuation">]</span> Error <span class="token number">1</span>
 make<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/build/linux_i486_compiler2/product'</span>
 /home/ling/jdk/hotspot/make/linux/makefiles/top.make:119: recipe <span class="token keyword">for</span> target <span class="token string">'the_vm'</span> failed
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>the_vm<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/build/linux_i486_compiler2/product'</span>
 /home/ling/jdk/hotspot/make/linux/Makefile:289: recipe <span class="token keyword">for</span> target <span class="token string">'product'</span> failed
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>product<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/build'</span>
 Makefile:216: recipe <span class="token keyword">for</span> target <span class="token string">'generic_build2'</span> failed
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>generic_build2<span class="token punctuation">]</span> Error <span class="token number">2</span>
 make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/ling/jdk/hotspot/make'</span>
 Makefile:167: recipe <span class="token keyword">for</span> target <span class="token string">'product'</span> failed
 make: *** <span class="token punctuation">[</span>product<span class="token punctuation">]</span> Error <span class="token number">2</span>

 <span class="token comment"># 解决方式一:</span>
 <span class="token function">apt-get</span> <span class="token function">install</span> gcc-multilib 这样构建的是32位版本
 <span class="token comment"># 解决方式二:</span>
 <span class="token builtin class-name">export</span> <span class="token assign-left variable">LP64</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/container/kubernetes.html" class="prev">
        Kubernetes
      </a></span> <span class="next"><a href="/java/reactive.html">
        Java响应式编程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2f3fe2a3.js" defer></script><script src="/assets/js/2.d5f9c639.js" defer></script><script src="/assets/js/17.f717296a.js" defer></script>
  </body>
</html>
